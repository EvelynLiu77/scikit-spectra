<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>skspec.core.spectra &mdash; scikit-spectra 0.3.1-2 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3.1-2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="scikit-spectra 0.3.1-2 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../../../index.html">scikit-spectra 0.3.1-2 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>


<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/new_logo.png" border="100" alt="sampledoc"/></a>
</div>


    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for skspec.core.spectra</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Provides core &quot;Spectra&quot; class and associated utilities.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">MethodType</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>

<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">DatetimeIndex</span><span class="p">,</span> <span class="n">Index</span><span class="p">,</span> <span class="n">Series</span><span class="p">,</span> <span class="n">read_csv</span><span class="p">,</span> <span class="n">MultiIndex</span>
<span class="kn">from</span> <span class="nn">pandas.core.common</span> <span class="kn">import</span> <span class="n">_is_bool_indexer</span>
<span class="kn">from</span> <span class="nn">pandas.core.indexing</span> <span class="kn">import</span> <span class="n">_is_list_like</span><span class="p">,</span> <span class="n">_is_nested_tuple</span>

<span class="c"># skspec imports </span>
<span class="kn">from</span> <span class="nn">skspec.core.specindex</span> <span class="kn">import</span> <span class="n">SpecIndex</span>
<span class="kn">from</span> <span class="nn">skspec.core.abcindex</span> <span class="kn">import</span> <span class="n">ConversionIndex</span><span class="p">,</span> <span class="n">CustomIndex</span>
<span class="kn">from</span> <span class="nn">skspec.core.specstack</span> <span class="kn">import</span> <span class="n">SpecStack</span>
<span class="kn">from</span> <span class="nn">skspec.core.abcspectra</span> <span class="kn">import</span> <span class="n">ABCSpectra</span><span class="p">,</span> <span class="n">SpecError</span>

<span class="kn">import</span> <span class="nn">skspec.core.utilities</span> <span class="kn">as</span> <span class="nn">pvutils</span>
<span class="kn">import</span> <span class="nn">skspec.config</span> <span class="kn">as</span> <span class="nn">pvconfig</span>
<span class="kn">from</span> <span class="nn">skspec.units.abcunits</span> <span class="kn">import</span> <span class="n">IUnit</span><span class="p">,</span> <span class="n">Unit</span>

<span class="c"># Merge</span>
<span class="kn">from</span> <span class="nn">skspec.pandas_utils.metadframe</span> <span class="kn">import</span> <span class="n">MetaDataFrame</span><span class="p">,</span> <span class="n">MetaSeries</span>
<span class="kn">from</span> <span class="nn">skspec.logger</span> <span class="kn">import</span> <span class="n">decode_lvl</span><span class="p">,</span> <span class="n">logclass</span>
<span class="kn">from</span> <span class="nn">skspec.plotting</span> <span class="kn">import</span> <span class="n">PLOTPARSER</span><span class="p">,</span> <span class="n">_genplot</span><span class="p">,</span> <span class="n">_gen2d3d</span><span class="p">,</span> <span class="n">areaplot</span>
<span class="kn">from</span> <span class="nn">skspec.exceptions</span> <span class="kn">import</span> <span class="n">badkey_check</span><span class="p">,</span> <span class="n">badcount_error</span><span class="p">,</span> <span class="n">RefError</span><span class="p">,</span> <span class="n">BaselineError</span>

<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">date2num</span> <span class="k">as</span> <span class="n">_d2num</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span> 


<span class="c">### _normdic, from_T, to_T and spec_slice all used to be in speclabeltool.py###</span>
<span class="n">_normdic</span><span class="o">=</span><span class="p">{</span><span class="bp">None</span><span class="p">:</span><span class="s">&#39;No Normalization&#39;</span><span class="p">,</span> <span class="c">#Don&#39;t change without updating normplot; relies on these keys </span>
      <span class="s">&#39;t&#39;</span><span class="p">:</span><span class="s">&#39;Transmittance&#39;</span><span class="p">,</span> 
      <span class="s">&#39;%t&#39;</span><span class="p">:</span><span class="s">&#39;(%)Transmittance&#39;</span><span class="p">,</span> 
      <span class="s">&#39;r&#39;</span><span class="p">:</span><span class="s">&#39;Inverse Transmittance (1/T)&#39;</span><span class="p">,</span>
      <span class="s">&#39;a&#39;</span><span class="p">:</span><span class="s">&#39;Absorbance (base 10)&#39;</span><span class="p">,</span> 
      <span class="s">&#39;a(ln)&#39;</span><span class="p">:</span><span class="s">&#39;Absorbance (base e)&#39;</span><span class="p">}</span> 


<span class="c">### Remember, data is already divided by ref before from_T is called, so &quot;r&quot; is base unit, not &quot;t&quot;.  </span>
<span class="n">from_T</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;t&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> 
        <span class="s">&#39;%t&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span> <span class="n">x</span><span class="p">),</span> 
        <span class="s">&#39;r&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> 
        <span class="s">&#39;a&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="s">&#39;a(ln)&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>


<span class="n">to_T</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;t&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">,</span> 
      <span class="s">&#39;%t&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">,</span> 
      <span class="s">&#39;r&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> 
      <span class="s">&#39;a&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">),</span> 
      <span class="s">&#39;a(ln)&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)}</span> 


<div class="viewcode-block" id="spec_slice"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.spec_slice">[docs]</a><span class="k">def</span> <span class="nf">spec_slice</span><span class="p">(</span><span class="n">spectral_array</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Simple method that will divide a spectral index into n evenly sliced</span>
<span class="sd">   bins and return as nested tuples. Useful for generating wavelength slices </span>
<span class="sd">   with even spacing.  Simply a wrapper around np.histogram.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">edges</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">spectral_array</span><span class="p">,</span> <span class="n">bins</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
   <span class="k">return</span> <span class="p">[</span> <span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)))]</span>

<span class="c"># Unit validations</span></div>
<span class="k">def</span> <span class="nf">_valid_xunit</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dic</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Validates existence of key (usually a unit type like spectral unit in a dictionary such as specunits)&quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">badkey_check</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
      <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>    


<span class="k">def</span> <span class="nf">_valid_norm</span><span class="p">(</span><span class="n">sout</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;When user is switching spectral intensity units, make sure they do it write.&quot;&quot;&quot;</span>
   <span class="k">return</span> <span class="n">_valid_xunit</span><span class="p">(</span><span class="n">sout</span><span class="p">,</span> <span class="n">_normdic</span><span class="p">)</span>

<span class="c"># Used by varunits, specunits, etc... if user doesn&#39;t realize their api</span>
<span class="c"># doesn&#39;t support UNITS.  Don&#39;t delete</span>
<span class="k">def</span> <span class="nf">_valid_indextype</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Checks index object to make sure it subclasses from ConversionIndex.</span>
<span class="sd">   Used for methods like as_specunit(), where only a valid operation if</span>
<span class="sd">   underlying Index is a SpecIndex.  Custom Spectra that use, say a Float64Index</span>
<span class="sd">   would not support such unit system operations.  Probably a cornercase;</span>
<span class="sd">   most skspec Spectra subclasses will strictly type Index.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">try</span><span class="p">:</span>
      <span class="n">index</span><span class="o">.</span><span class="n">unitshortdict</span>
   <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&#39;Unit API only supported by skspec ConversionIndex&#39;</span>
                      <span class="s">&#39; got type </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>    


<div class="viewcode-block" id="specplot"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.specplot">[docs]</a><span class="k">def</span> <span class="nf">specplot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">pltkwargs</span><span class="p">):</span>   
   <span class="sd">&quot;&quot;&quot; Plotting interface.  Use kind=&#39;surf, wire etc...&#39; to go through </span>
<span class="sd">   various plot types.  Will append correct x and y labels.</span>
<span class="sd">   </span>
<span class="sd">   Parameters</span>
<span class="sd">   ----------</span>
<span class="sd">   </span>
<span class="sd">   norm : None or str</span>
<span class="sd">       Shortcut to return timespectra in normalized ref system (ie Absorbance)</span>
<span class="sd">       without changing the Spectra.</span>
<span class="sd">       </span>
<span class="sd">   &quot;&quot;&quot;</span>
   
   <span class="n">kind</span> <span class="o">=</span> <span class="n">pltkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;kind&#39;</span><span class="p">,</span> <span class="s">&#39;spec&#39;</span><span class="p">)</span>   
   <span class="n">norm</span> <span class="o">=</span> <span class="n">pltkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;norm&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

   <span class="c"># FORCE DEFAULT COLOR/COLORMAPS</span>
   <span class="k">if</span> <span class="s">&#39;cmap&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pltkwargs</span> <span class="ow">and</span> <span class="s">&#39;color&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pltkwargs</span> <span class="ow">and</span> <span class="s">&#39;colors&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pltkwargs</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;spec&#39;</span><span class="p">:</span>
         <span class="n">pltkwargs</span><span class="p">[</span><span class="s">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">CMAP_1DSPECPLOT</span>
      <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;contour&#39;</span><span class="p">:</span>
         <span class="n">pltkwargs</span><span class="p">[</span><span class="s">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">CMAP_CONTOUR</span>
      <span class="k">elif</span> <span class="n">PLOTPARSER</span><span class="o">.</span><span class="n">is_3d</span><span class="p">(</span><span class="n">kind</span><span class="p">):</span>        
         <span class="n">pltkwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">COLOR_3DPLOT</span>
      
   
   <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">norm</span> <span class="o">!=</span> <span class="n">norm</span><span class="p">:</span>  <span class="c">#Better/general way to do this? (_normdic.keys())</span>
         <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">as_norm</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span>      

   <span class="k">if</span> <span class="ow">not</span> <span class="n">ts</span><span class="o">.</span><span class="n">_base_sub</span><span class="p">:</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Spectrum does not have subtracted baseline; could affect &#39;</span>
                           <span class="s">&#39;result in specious absorbance data.&#39;</span><span class="p">)</span>          

   <span class="c"># Area plot gets special axis label   </span>
   <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;area&#39;</span><span class="p">:</span>
      <span class="n">pltkwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;xlabel&#39;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">full_varunit</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">pltkwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;xlabel&#39;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">full_specunit</span><span class="p">)</span>

   <span class="n">pltkwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>            

   <span class="n">pltfcn</span><span class="p">,</span> <span class="n">is_2d_3d</span> <span class="o">=</span> <span class="n">PLOTPARSER</span><span class="p">[</span><span class="n">kind</span><span class="p">]</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">PLOTPARSER</span><span class="o">.</span><span class="n">is_2d_3d</span><span class="p">(</span><span class="n">kind</span><span class="p">)</span>
   
   <span class="k">if</span> <span class="n">is_2d_3d</span><span class="p">:</span>
      <span class="n">pltkwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;ylabel&#39;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">full_varunit</span><span class="p">)</span>      
      <span class="n">pltkwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;zlabel&#39;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">full_iunit</span><span class="p">)</span> 
   
   <span class="k">else</span><span class="p">:</span>
      <span class="n">pltkwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;ylabel&#39;</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">full_iunit</span><span class="p">)</span>
               
   <span class="c"># Hack </span>
   <span class="k">if</span> <span class="n">pltfcn</span> <span class="o">==</span> <span class="n">_gen2d3d</span><span class="p">:</span>
      <span class="n">pltkwargs</span><span class="p">[</span><span class="s">&#39;kind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kind</span>
      
   <span class="n">ax</span> <span class="o">=</span> <span class="n">pltfcn</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">pltkwargs</span><span class="p">)</span>

   <span class="c"># Some plot methods return (ax, mappable), some just ax</span>
   <span class="k">try</span><span class="p">:</span>
      <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
      <span class="k">pass</span>
   
   <span class="c"># Reverse X-axis for all PLOT TYPES (EXCEPT CONTOUR)</span>
   <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s">&#39;contour&#39;</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;waterfall&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c"># HACK</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 

   <span class="k">return</span> <span class="n">ax</span>


<span class="c">########################################</span>
<span class="c">## Spectra Public Utilities    #####</span>
<span class="c">######################################## </span>


<span class="c"># Wrapper for df_from_directory</span></div>
<div class="viewcode-block" id="spec_from_dir"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.spec_from_dir">[docs]</a><span class="k">def</span> <span class="nf">spec_from_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">csvargs</span><span class="p">,</span> <span class="n">sortnames</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">concat_axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shortname</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cut_extension</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Takes files from a directory, presuming they are identically formatted, and reads them into</span>
<span class="sd">   a dataframe by iterating over read_csv().  All arguments that read_csv() would take are passed</span>
<span class="sd">   in.  These kwargs are in regard the files themselves, for example, skiprows, skipfooter and header.</span>

<span class="sd">   For now, no support for glob to take only files of a certain file extension.</span>
<span class="sd">   For now, conctaentation occurs along</span>

<span class="sd">   Args:</span>
<span class="sd">      directory- Path to directory where files are stored.</span>
<span class="sd">      csvargs- Dictionary of arguments that are passed directly to the read_csv() function. For example</span>
<span class="sd">               skiprows, header, na_values etc... see pandas API for read_csv()</span>

<span class="sd">   Kwds:</span>
<span class="sd">      sortnames- Will attempt to autosort the filelist. Otherwise, files are ordered by the module</span>
<span class="sd">                 os.path.listdir().</span>

<span class="sd">      concat_axis- How to merge datafiles into a dataframe.  Default is axis=1, which means all files </span>
<span class="sd">                   should share the same index values.  I use this for spectral data where the wavelength</span>
<span class="sd">                   column is my dataframe index.</span>

<span class="sd">      shortname- If false, full file path is used as the column name.  If true, only the filename is used. </span>

<span class="sd">      cut_extension- If kwd shortname is True, this will determine if the file extension is saved or cut from the data.&quot;&quot;&quot;</span>

   <span class="k">return</span> <span class="n">Spectra</span><span class="p">(</span><span class="n">df_from_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> 
                                    <span class="n">csvargs</span><span class="p">,</span>
                                    <span class="n">sortnames</span><span class="o">=</span><span class="n">sortnames</span><span class="p">,</span> 
                                    <span class="n">concat_axis</span><span class="o">=</span><span class="n">concat_axis</span><span class="p">,</span> 
                                    <span class="n">shortname</span><span class="o">=</span><span class="n">shortname</span><span class="p">,</span> 
                                    <span class="n">cut_extension</span><span class="o">=</span><span class="n">cut_extension</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Spectrum"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectrum">[docs]</a><span class="k">class</span> <span class="nc">Spectrum</span><span class="p">(</span><span class="n">ABCSpectra</span><span class="p">,</span> <span class="n">MetaSeries</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Compliment to pandas Series: single array of spectral values with</span>
<span class="sd">   spectral Index.</span>
<span class="sd">   &quot;&quot;&quot;</span>
   
   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      
      <span class="n">specifier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;specifier&#39;</span><span class="p">,</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">SPECIFIERDEF</span><span class="p">)</span>
      <span class="c"># CUSTOMIZE!?</span>
      <span class="nb">super</span><span class="p">(</span><span class="n">Spectrum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>        
      <span class="bp">self</span><span class="o">.</span><span class="n">specifier</span> <span class="o">=</span> <span class="n">specifier</span>
        

   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_unit</span><span class="o">.</span><span class="n">short</span>   
   
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">full_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_unit</span><span class="o">.</span><span class="n">full</span>

   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Header for string printout &quot;&quot;&quot;</span>
      <span class="n">delim</span> <span class="o">=</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">HEADERDELIM</span>
      
      <span class="c"># Certain methods aren&#39;t copying this correctly.  Delete later if fix</span>

      <span class="n">unit</span> <span class="o">=</span> <span class="n">pvutils</span><span class="o">.</span><span class="n">safe_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;full_unit&#39;</span><span class="p">)</span>
      <span class="n">iunit</span> <span class="o">=</span> <span class="n">pvutils</span><span class="o">.</span><span class="n">safe_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;full_iunit&#39;</span><span class="p">)</span>
      
   
      <span class="n">header</span> <span class="o">=</span> <span class="s">&quot;*</span><span class="si">%s</span><span class="s">*</span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]</span><span class="si">%s</span><span class="s">Iunit: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
             <span class="n">delim</span><span class="p">,</span> 
             <span class="n">unit</span><span class="p">,</span>
             <span class="n">delim</span><span class="p">,</span> 
             <span class="n">iunit</span><span class="p">)</span>
      
      <span class="k">return</span> <span class="n">header</span>


   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">_header_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Header for html printout &quot;&quot;&quot;</span>
      
      <span class="n">delim</span> <span class="o">=</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">HEADERHTMLDELIM</span>
   
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">colorshape</span> <span class="o">=</span> <span class="s">&#39;&lt;font color=&quot;#0000CD&quot;&gt;(</span><span class="si">%s</span><span class="s"> X </span><span class="si">%s</span><span class="s">)&lt;/font&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">colorshape</span> <span class="o">=</span> <span class="s">&#39;&lt;font color=&quot;#0000CD&quot;&gt; (</span><span class="si">%s</span><span class="s">)&lt;/font&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

      <span class="n">unit</span> <span class="o">=</span> <span class="n">pvutils</span><span class="o">.</span><span class="n">safe_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;full_unit&#39;</span><span class="p">)</span>
      <span class="n">iunit</span> <span class="o">=</span> <span class="n">pvutils</span><span class="o">.</span><span class="n">safe_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;full_iunit&#39;</span><span class="p">)</span>

      <span class="n">header</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&amp;nbsp</span><span class="si">%s%s</span><span class="s"> Index Unit:&amp;nbsp</span><span class="si">%s%s</span><span class="s">Iunit:&amp;nbsp</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> 
          <span class="n">colorshape</span><span class="p">,</span>
          <span class="n">delim</span><span class="p">,</span>
          <span class="n">unit</span><span class="p">,</span>
          <span class="n">delim</span><span class="p">,</span>
          <span class="n">iunit</span><span class="p">)</span>   
      
      <span class="k">return</span> <span class="n">header</span>   
   
<div class="viewcode-block" id="Spectrum.plot"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectrum.plot">[docs]</a>   <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">pltkwds</span><span class="p">):</span>

      <span class="c"># Replace w/ set defaults</span>
      <span class="n">pltkwds</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
      <span class="n">pltkwds</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">)</span> <span class="c"># If removing, colormap default in _genplot</span>
                                           <span class="c"># Will cause bug</span>
      
      <span class="n">pltkwds</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;xlabel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
      <span class="n">pltkwds</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;ylabel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">specifier</span><span class="p">)</span>
      <span class="n">pltkwds</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      
      <span class="k">return</span> <span class="n">_genplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">pltkwds</span><span class="p">)</span>
   </div>
   <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Spectrum.from_series"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectrum.from_series">[docs]</a>   <span class="k">def</span> <span class="nf">from_series</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; When Spectra methods need to return a Spectrum, this is called</span>
<span class="sd">      so that metadata is properly transferred.</span>
<span class="sd">      &quot;&quot;&quot;</span>

      <span class="c"># Will I ever want to construct from something other than Series?</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
         <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&#39;Spectrum.from_series() requires series input,&#39;</span>
                         <span class="s">&#39;got </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>
     
      <span class="n">out</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

      <span class="k">def</span> <span class="nf">_transfer</span><span class="p">(</span><span class="n">attr</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39;If attr not in kwargs, trasnfer from spectra object&#39;&#39;&#39;</span>

         <span class="c"># Should work for all valid attr, since spectra sets its own defaults </span>
         <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">pvutils</span><span class="o">.</span><span class="n">hasgetattr</span><span class="p">(</span><span class="n">spectra</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="s">&#39;invalid transfer&#39;</span><span class="p">)</span>
         <span class="nb">setattr</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
      
      <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span> 
<span class="c">#                   &#39;varunit&#39;, </span>
<span class="c">#                   &#39;full_varunit&#39;,</span>
                   <span class="s">&#39;name&#39;</span><span class="p">,</span> 
                   <span class="s">&#39;norm&#39;</span><span class="p">,</span> 
                   <span class="s">&#39;full_norm&#39;</span><span class="p">,</span> 
                   <span class="s">&#39;_iunit&#39;</span>    <span class="c">#Pass private variable, because iunit defined in ABC spec</span>
                   <span class="p">]:</span>            <span class="c">#Otherwise, properties like specunit become just attributes</span>
                           
         <span class="n">_transfer</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
      
      <span class="k">return</span> <span class="n">out</span>
   
   
   </div></div>
<div class="viewcode-block" id="Spectra"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra">[docs]</a><span class="k">class</span> <span class="nc">Spectra</span><span class="p">(</span><span class="n">ABCSpectra</span><span class="p">,</span> <span class="n">MetaDataFrame</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; Provides core Spectra composite pandas DataFrame to represent a set </span>
<span class="sd">   of spectral data.  Enforces spectral data along the index and temporal </span>
<span class="sd">   data as columns.  The spectral index is controlled from the specindex module, </span>
<span class="sd">   which has a psuedo-class called SpecIndex (really a monkey patched Index). </span>
<span class="sd">   Temporal data is stored using a DatetimeIndex or a modified interval </span>
<span class="sd">   reprentation.  The need to support two types of temporal index, one of </span>
<span class="sd">   which is Pandas builtin DatetimeIndex is what led me to not create a </span>
<span class="sd">   special index object (like SpecIndex).  Other spectral axis types (like </span>
<span class="sd">   Temperature axis) should probably be built close to the manner of Spec index.</span>
<span class="sd">   The Spectra dataframe actually stores enough temporal metadatato go back </span>
<span class="sd">   and forth between DatetimeIndex and Interval representations.  </span>
<span class="sd">   It does this by generating one or the other on the fly, and never relies on </span>
<span class="sd">   the current label object to generate teh next object.</span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">dfargs</span><span class="p">,</span> <span class="o">**</span><span class="n">dfkwargs</span><span class="p">):</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">_strict_index</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;strict_index&#39;</span><span class="p">,</span> <span class="n">SpecIndex</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_strict_columns</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;strict_columns&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

      <span class="c"># Pop default DataFrame keywords before initializing###</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>

      <span class="c"># Spectral index-related keywords</span>
      <span class="n">specunit</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;specunit&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
      <span class="n">varunit</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;varunit&#39;</span><span class="p">,</span> <span class="n">Unit</span><span class="p">())</span>
      <span class="n">iunit</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;iunit&#39;</span><span class="p">,</span> <span class="n">IUnit</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="s">&#39;cts&#39;</span><span class="p">,</span> 
                                         <span class="n">full</span><span class="o">=</span><span class="s">&#39;Counts (photons)&#39;</span><span class="p">,</span>
                                         <span class="n">symbol</span><span class="o">=</span><span class="s">r&#39;$\gamma$&#39;</span><span class="p">)</span> <span class="c"># ever used? </span>
                                         <span class="p">)</span>
      
      <span class="c"># Intensity data-related stuff</span>
      <span class="n">norm</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;norm&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

      <span class="c"># Time index-related keywords  (note, the are only used if a </span>
      <span class="c"># DatetimeIndex is not passed in)</span>
      <span class="n">reference</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;reference&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>        
      <span class="n">bline</span> <span class="o">=</span> <span class="n">dfkwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;baseline&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

      <span class="c"># Logging __init__() in @logclass can&#39;t access self.name</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Initializing </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>  <span class="s">&#39;</span><span class="si">%s</span><span class="s">:(name = </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> 
                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>


      <span class="nb">super</span><span class="p">(</span><span class="n">Spectra</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">dfargs</span><span class="p">,</span> <span class="o">**</span><span class="n">dfkwargs</span><span class="p">)</span>        

      <span class="c"># Iunit</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">iunit</span> <span class="o">=</span> <span class="n">iunit</span>

      <span class="c"># Convert to the passed unit        </span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">specunit</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">specunit</span> <span class="o">=</span> <span class="n">specunit</span>
<span class="c">#         self._frame.index = self._frame.index.convert(specunit)          </span>

      <span class="c"># Convert to the passed unit</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_columns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>            
      <span class="k">if</span> <span class="n">varunit</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">varunit</span> <span class="o">=</span> <span class="n">varunit</span>
<span class="c">#         self._frame.columns = self._frame.columns.convert(varunit)     </span>

      <span class="c"># Assign spectral intensity related stuff but </span>
      <span class="c"># DONT CALL _set_normtype function</span>
      <span class="n">norm</span> <span class="o">=</span><span class="n">_valid_norm</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_normtype</span> <span class="o">=</span> <span class="n">norm</span>

      <span class="c"># This has to be done AFTER self._frame has been set</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference_valid</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span><span class="c">#SHOULD DEFAULT TO NONE SO USER CAN PASS NORMALIZED DATA WITHOUT REF        </span>

      <span class="c"># Baseline Initialization (UNTESTED)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span> <span class="o">=</span> <span class="bp">False</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span> <span class="o">=</span> <span class="bp">None</span>  

      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bline</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">baseline</span> <span class="o">=</span> <span class="n">bline</span>

      <span class="c"># Store intrinsic attributes for output later by listattr methods</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_intrinsic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_intrinsic</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span> <span class="c">#Not a private attr</span>

      <span class="c"># Which attributes/methods are manipulated along with the dataframe</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdattr</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;_reference&#39;</span><span class="p">,</span> <span class="s">&#39;_baseline&#39;</span><span class="p">]</span><span class="c">#, &#39;strict_index&#39;, &#39;strict_columns&#39;]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdmeth</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;_slice&#39;</span><span class="p">,</span> <span class="s">&#39;pvutils.boxcar&#39;</span><span class="p">]</span> <span class="c">#_slice is ix</span>


   <span class="k">def</span> <span class="nf">_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statement</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;info&#39;</span><span class="p">):</span>
      <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
         <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span>

      <span class="n">statement</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">decode_lvl</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="n">statement</span><span class="p">)</span>


   <span class="c">###########################################################################    </span>
   <span class="c"># Methods ( @property decorators ensure use can&#39;t overwrite methods) ####   </span>
   <span class="c">#############################################################################</span>

   <span class="c"># Unit printouts (change to pretty print?)</span>
   <span class="k">def</span> <span class="nf">_list_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outdic</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Generic output method for shortname:longname iterables.  Prints out various</span>
<span class="sd">      dictionaries, and is independent of the various datastructures contained&quot;&quot;&quot;</span>
      <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Key&#39;</span><span class="p">,</span><span class="n">delim</span><span class="p">,</span><span class="s">&#39;Description&#39;</span>
      <span class="k">print</span> <span class="s">&#39;-------------------</span><span class="se">\n</span><span class="s">&#39;</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">outdic</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
         <span class="k">print</span> <span class="n">k</span><span class="p">,</span><span class="n">delim</span><span class="p">,</span><span class="n">v</span>
      <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

<div class="viewcode-block" id="Spectra.varunits"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.varunits">[docs]</a>   <span class="k">def</span> <span class="nf">varunits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">pprint</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Print out all available variable units in a nice format&quot;&quot;&quot;</span>
      <span class="n">_valid_indextype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">unitshortdict</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">pprint</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">out</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_out</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">)</span>        
</div>
<div class="viewcode-block" id="Spectra.norms"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.norms">[docs]</a>   <span class="k">def</span> <span class="nf">norms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">pprint</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Intensity units of dateframe.  Eg %Transmittance vs. Absorbance&quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">pprint</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">_normdic</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_out</span><span class="p">(</span><span class="n">_normdic</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">)</span>
</div>
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">plot_kinds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; List available plot kinds&quot;&quot;&quot;</span>
      <span class="k">print</span> <span class="n">PLOTPARSER</span><span class="o">.</span><span class="n">__shortrepr__</span><span class="p">()</span>

   <span class="c"># Properties, private, etc...?</span>
   <span class="k">def</span> <span class="nf">_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
      
      
   <span class="k">def</span> <span class="nf">_summary_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span><span class="s">&quot;&quot;</span>

   <span class="c"># Self necessary here or additional df stuff gets printed   </span>
<div class="viewcode-block" id="Spectra.specunits"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.specunits">[docs]</a>   <span class="k">def</span> <span class="nf">specunits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">pprint</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Print out all available units in a nice format&quot;&quot;&quot;</span>
      <span class="n">_valid_indextype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unitshortdict</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">pprint</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">out</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_out</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="n">delim</span><span class="p">)</span> 

   <span class="c"># ADD PYTHON STRING FORMATTING TO THIS</span></div>
<div class="viewcode-block" id="Spectra.list_attr"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.list_attr">[docs]</a>   <span class="k">def</span> <span class="nf">list_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">privattr</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dfattr</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">sortby</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">):</span> <span class="c">#values=False,):</span>
      <span class="sd">&quot;&quot;&quot; Outputs various attributes in the namespace, as well as their types.</span>

<span class="sd">      Parameters</span>
<span class="sd">      ----------</span>
<span class="sd">         privattr: Should private attributes be listed.</span>
<span class="sd">         dfattr: Should dataframe&#39;s attributes (eg shape, columns) be listed</span>
<span class="sd">         methods: If True, methods will be output; otherwise, only non-method attributes are listed.</span>
<span class="sd">         types: Output the type of attribute along with it?</span>
<span class="sd">         delim: For formatting.</span>
<span class="sd">         sortby: If outputing by type, order by name or by type?</span>

<span class="sd">      Notes</span>
<span class="sd">      -----</span>
<span class="sd">         Would like to add &quot;values&quot; but the formatting might get messy.  A good IDE can provide this information anyway,</span>
<span class="sd">         for example, Stack Data in windware.  Also increases complexity of the logic below.</span>
<span class="sd">         Refer to label_stats() for more detailed information on certain attributes.</span>
<span class="sd">      .&quot;&quot;&quot;</span>

      <span class="c"># Take all attributes in current instance        </span>
      <span class="n">atts</span><span class="o">=</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

      <span class="c"># Remove self._intrinsic (aka class attributes) if desired</span>
      <span class="k">if</span> <span class="n">privattr</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
         <span class="n">atts</span><span class="o">=</span><span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">atts</span> <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intrinsic</span><span class="p">]</span>        
         <span class="n">filterout</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;_intrinsic&#39;</span><span class="p">,</span> <span class="s">&#39;ix&#39;</span><span class="p">,</span> <span class="s">&#39;_ix&#39;</span><span class="p">,</span> <span class="s">&#39;list_attr&#39;</span><span class="p">]</span> <span class="c">#Don&#39;t want these as attributes</span>
         <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">filterout</span><span class="p">:</span>
            <span class="n">atts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">att</span><span class="p">)</span>

      <span class="c"># Include dataframe attributes if desired</span>
      <span class="k">if</span> <span class="n">dfattr</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
         <span class="n">atts</span><span class="o">=</span><span class="n">atts</span><span class="o">+</span><span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="p">)</span> <span class="k">if</span> <span class="s">&#39;__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

      <span class="c"># Remove methods if desired</span>
      <span class="k">if</span> <span class="n">methods</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
         <span class="n">atts</span><span class="o">=</span><span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">atts</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">),</span> <span class="n">MethodType</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">atts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;ix&#39;</span><span class="p">)</span> <span class="c">#This as an attribute but want it to seem like a method</span>

      <span class="c"># Should output include types and/or values?</span>
      <span class="n">outheader</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Attribute&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">types</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span> 
         <span class="n">outheader</span><span class="o">=</span><span class="n">outheader</span><span class="o">+</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span>
         <span class="n">atts</span><span class="o">=</span><span class="p">[(</span><span class="n">att</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">)))</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">atts</span><span class="p">]</span>
         <span class="c">#string operation just does str(&lt;type &#39;int&#39;&gt;) ---&gt; &#39;int&#39;</span>


         <span class="c"># Sort output either by name or type</span>
         <span class="n">badkey_check</span><span class="p">(</span><span class="n">sortby</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">])</span> <span class="c">#sortby must be &#39;name&#39; or &#39;type&#39;</span>

         <span class="k">if</span> <span class="n">sortby</span> <span class="o">==</span> <span class="s">&#39;name&#39;</span><span class="p">:</span>
            <span class="n">atts</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">atts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
         <span class="k">elif</span> <span class="n">sortby</span> <span class="o">==</span> <span class="s">&#39;type&#39;</span><span class="p">:</span>
            <span class="n">atts</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">atts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

      <span class="c"># Output to screen</span>
      <span class="k">print</span> <span class="n">delim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outheader</span><span class="p">)</span>    
      <span class="k">print</span> <span class="s">&#39;--------------------&#39;</span>
      <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">atts</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">types</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">string</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">delim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">att</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span> <span class="c">#MAKE &#39;\N&#39; comprehension if string format never works out</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">att</span>    


   <span class="c">########################</span>
   <span class="c"># ts.refrence operations</span>
   <span class="c">########################</span>
</div>
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">reference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; This is stored as a Series unless user has set it otherwise.&quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

   <span class="nd">@reference.setter</span>
   <span class="k">def</span> <span class="nf">reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">force_series</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>  
      <span class="sd">&quot;&quot;&quot; Before changing reference, first validates.  Then considers various cases, and changes </span>
<span class="sd">      class attributes and dataframe values appropriately.&quot;&quot;&quot;</span>

      <span class="n">int_or_column</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>            
         <span class="n">int_or_column</span> <span class="o">=</span> <span class="bp">True</span>

      <span class="c"># Adding or changing reference</span>
      <span class="k">if</span> <span class="n">reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoneType</span><span class="p">:</span>

         <span class="c"># If data is in raw/full mode (normtype=None)</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normtype</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">reference</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference_valid</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">force_series</span><span class="o">=</span><span class="n">force_series</span><span class="p">)</span>                  

            <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="o">=</span><span class="n">reference</span>

         <span class="c"># Let _set_normtype() do lifting.  Basically convert to full and back to current normtype. </span>
         <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_normtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normtype</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">int_or_column</span><span class="p">:</span>            
               <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Reference changed based on column data while&#39;</span>
                           <span class="s">&#39;Spectra was normalized.&#39;</span><span class="p">)</span>            

      <span class="c"># Removing reference.  </span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c"># If current reference is not None, convert</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">):</span>  <span class="c">#Can&#39;t do if array==None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_normtype</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="o">=</span><span class="bp">None</span>


   <span class="k">def</span> <span class="nf">_reference_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">force_series</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">zero_warn</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nan_warn</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Helper method for to handles various scenarios of valid references.  Eg user wants to </span>
<span class="sd">      convert the spectral representation, this evaluates manually passed ref vs. internally stored one.</span>

<span class="sd">      Parameters:</span>
<span class="sd">      -----------</span>
<span class="sd">      ref: reference object for inspection.   See notes for more details of validation process.</span>
<span class="sd">      force_series:  If true, reference is forced to a Series type.</span>
<span class="sd">      zero_warn: If true, a warning is raised if reference contains zeros.</span>
<span class="sd">      nan_warn:  If true, a warning is raised if reference contains nans.</span>

<span class="sd">      Notes:</span>
<span class="sd">      ------</span>

<span class="sd">      This goes through several cases to determine reference.  In order, it attempts to get the reference from:</span>
<span class="sd">          1. Column name from dataframe.</span>
<span class="sd">          2. Column index from dataframe.</span>
<span class="sd">          3. Uses ref itself.</span>
<span class="sd">             a. If series, checks for compatibility between spectral indicies.</span>
<span class="sd">             b. If dataframe, ensures proper index and shape (1-d) and converts to series (if force_series True).</span>
<span class="sd">             c. If iterable, converts to series (if force_series True)</span>

<span class="sd">      Errors will be thrown if new reference does not have identical spectral values to self._frame.index as evaluated by</span>
<span class="sd">      numpy.np.array_equal()</span>

<span class="sd">      Zero_warn and nan_warn are useful when the user plans on changing intensity units of the data.  For example,</span>
<span class="sd">      converting from raw data to absorbance data, a relative division will result in hard-to-spot errors due to</span>
<span class="sd">      the 0&#39;s and nans in the original reference. </span>
<span class="sd">      &quot;&quot;&quot;</span>


      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">):</span>
         <span class="k">return</span> <span class="n">ref</span>

      <span class="c"># First, try ref is itself a column name</span>
      <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
         <span class="n">rout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span>

      <span class="c"># If rtemp is an integer, return that column value.  </span>
      <span class="c"># NOTE: IF COLUMN NAMES ARE ALSO INTEGERS, THIS CAN BE PROBLEMATIC.</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
         <span class="n">rout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">ref</span><span class="p">]]</span>        

      <span class="c"># Finally if ref is itself a series, make sure it has the correct spectral index</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RefError</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">rout</span><span class="o">=</span><span class="n">ref</span>

      <span class="c"># Finally if array or other iterable, force to a series</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">force_series</span><span class="p">:</span>

            <span class="c"># If user passes dataframe, downconvert to series </span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>
               <span class="k">if</span> <span class="n">ref</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                  <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;reference must be a dataframe of a single column with index values equivalent to those of </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
               <span class="k">if</span> <span class="n">ref</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                  <span class="k">raise</span> <span class="n">RefError</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>                    
               <span class="k">else</span><span class="p">:</span>
                  <span class="n">rout</span><span class="o">=</span><span class="n">Series</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="n">ref</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">index</span><span class="o">=</span><span class="n">ref</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> 

            <span class="c"># Add index to current iterable </span>
            <span class="k">else</span><span class="p">:</span>
               <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                  <span class="k">raise</span> <span class="n">RefError</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>
                  <span class="n">rout</span><span class="o">=</span><span class="n">Series</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

         <span class="c"># Return itrable as is</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">rout</span><span class="o">=</span><span class="n">ref</span>

      <span class="k">if</span> <span class="n">nan_warn</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rout</span><span class="p">)):</span>  <span class="c">#Fast way to check for nan&#39;s</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Nans found in reference.  Error raised because &#39;</span>
                         <span class="s">&#39;&quot;nan_warn&quot; = True in _reference_valid()&#39;</span><span class="p">)</span>


      <span class="k">if</span> <span class="n">zero_warn</span><span class="p">:</span>
         <span class="k">if</span> <span class="mf">0.0</span> <span class="ow">in</span> <span class="n">rout</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Zero values found in reference.  Error raised &#39;</span>
                         <span class="s">&#39;because &quot;zero_warn&quot; = True in _reference valid()&#39;</span><span class="p">)</span>

      <span class="k">return</span> <span class="n">rout</span>  <span class="c">#MAKES MORE SENSE TO MAKE THIS A 1D DATAFRAME</span>


<div class="viewcode-block" id="Spectra.apply"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.apply">[docs]</a>   <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Raw=True seems to produce correct results more often from some</span>
<span class="sd">      #deep issue that is not fully tracked. &quot;&quot;&quot;</span>
      <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;raw&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
      <span class="n">specifier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;specifier&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
      <span class="c"># Call _dataframe attribute and transfer attributes</span>
      <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_framegetattr</span><span class="p">(</span><span class="s">&#39;apply&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
      
      <span class="c">## If Spectrum, use function name as specifier!</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">):</span>
         <span class="n">out</span><span class="o">.</span><span class="n">specifier</span> <span class="o">=</span> <span class="n">specifier</span>
      <span class="k">return</span> <span class="n">out</span>
   </div>
<div class="viewcode-block" id="Spectra.wavelength_slices"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.wavelength_slices">[docs]</a>   <span class="k">def</span> <span class="nf">wavelength_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">apply_fcn</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">applyfcn_kwds</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Returns sliced averages/sums of wavelength regions. Composite dataframe will nicely</span>
<span class="sd">      plot when piped into spec aesthetics timeplot.</span>


<span class="sd">      Parameters:</span>
<span class="sd">      -----------</span>
<span class="sd">      apply_fcn: Chooses the way to collapse data.  Builtin functions include &#39;mean&#39;</span>
<span class="sd">                &#39;sum&#39;, &#39;simps&#39;, &#39;trapz&#39;, &#39;romb&#39;, &#39;cumtrapz&#39;, but any user function that</span>
<span class="sd">                 results in collapsed data (eg averging function/integrators/etc...) can </span>
<span class="sd">                 be passed in with any relevant keywords.</span>

<span class="sd">      **apply_fcn_kdws: </span>
<span class="sd">                 If user is passing a function to apply_fcn that requires keywords, </span>
<span class="sd">                 the get passed in to dfcut.apply() </span>

<span class="sd">      Notes:</span>
<span class="sd">      -----_</span>
<span class="sd">      See description of &#39;df_wavelength_slices&#39; in utilities.py for more information.         </span>
<span class="sd">      For easy plotting, plot the transpose of the returned timespectra.  </span>
<span class="sd">      &quot;&quot;&quot;</span>   

      <span class="n">dflist</span><span class="o">=</span><span class="p">[];</span> <span class="n">snames</span><span class="o">=</span><span class="p">[]</span>

      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
         <span class="n">ranges</span><span class="o">=</span><span class="n">spec_slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span>           

      <span class="c"># If single range is passed in, want to make sure it can still be iterated over...</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ranges</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
         <span class="n">ranges</span><span class="o">=</span><span class="p">[</span><span class="n">ranges</span><span class="p">]</span>

      <span class="k">for</span> <span class="n">rng</span> <span class="ow">in</span> <span class="n">ranges</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;In slices function, all ranges passed in must be len 2, aka a start and stop </span><span class="se">\</span>
<span class="s">                pair.  </span><span class="si">%s</span><span class="s"> of length </span><span class="si">%s</span><span class="s"> was entered&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)))</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">dfcut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">snames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">apply_fcn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

               <span class="c"># For inverted xaxis</span>
               <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                  <span class="n">xvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
               <span class="k">else</span><span class="p">:</span>
                  <span class="n">xvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span>
               <span class="c"># Pandas cython operations ###</span>
               <span class="k">if</span> <span class="n">apply_fcn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;mean&#39;</span><span class="p">:</span> 
                  <span class="n">series</span><span class="o">=</span><span class="n">dfcut</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
               <span class="k">elif</span> <span class="n">apply_fcn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;sum&#39;</span><span class="p">:</span>
                  <span class="n">series</span><span class="o">=</span><span class="n">dfcut</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


               <span class="c"># Integration isn&#39;t the same as sum because it takes the units of the x-axis into account through x</span>
               <span class="c"># parameter.  If interval is odd, last interval is used w/ trapezoidal rule</span>
               <span class="k">elif</span> <span class="n">apply_fcn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;simps&#39;</span><span class="p">:</span>
                  <span class="n">series</span><span class="o">=</span><span class="n">dfcut</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">simps</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xvals</span><span class="p">,</span> <span class="n">even</span><span class="o">=</span><span class="s">&#39;last&#39;</span><span class="p">)</span>

               <span class="k">elif</span> <span class="n">apply_fcn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;trapz&#39;</span><span class="p">:</span>
                  <span class="n">series</span><span class="o">=</span><span class="n">dfcut</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xvals</span><span class="p">)</span>     

               <span class="k">elif</span> <span class="n">apply_fcn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;romb&#39;</span><span class="p">:</span>
                  <span class="n">series</span><span class="o">=</span><span class="n">dfcut</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">romb</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xvals</span><span class="p">)</span>

               <span class="k">elif</span> <span class="n">apply_fcn</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cumtrapz&#39;</span><span class="p">:</span>
                  <span class="n">series</span><span class="o">=</span><span class="n">dfcut</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xvals</span><span class="p">,</span> <span class="n">ititial</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>           

               <span class="k">else</span><span class="p">:</span>
                  <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;apply_fcn in wavelength slices, as a string, must be one of the following: </span><span class="se">\</span>
<span class="s">                        (mean, sum, simps, trapz, romb, cumtrapz) but </span><span class="si">%s</span><span class="s"> was entered.  Alternatively, you can pass </span><span class="se">\</span>
<span class="s">                        a function to apply_fcn, with any relevant **kwds&#39;</span><span class="p">)</span>

            <span class="c"># Try to apply arbirtrary function.  Note, function can&#39;t depend on dfcut, since </span>
            <span class="c"># that is created in here</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">series</span><span class="o">=</span><span class="n">dfcut</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">apply_fcn</span><span class="p">,</span> <span class="o">**</span><span class="n">applyfcn_kwds</span><span class="p">)</span>


            <span class="c"># OK</span>
            <span class="n">dflist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>

      <span class="c"># Out is a series (e.g. Area)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dflist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">dflist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transfer</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dflist</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">snames</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Spectra.boxcar"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.boxcar">[docs]</a>   <span class="k">def</span> <span class="nf">boxcar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binwidth</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Performs pvutils.boxcar averaging by binning data.</span>

<span class="sd">      Parameters</span>
<span class="sd">      ----------</span>
<span class="sd">      binwidth: int or float</span>
<span class="sd">         Width of the bin.  EG 10minutes or 5 seconds.</span>
<span class="sd">         </span>
<span class="sd">      axis: 0 or 1</span>
<span class="sd">         Average over rows or columns, respectively.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">varunit</span> <span class="o">==</span> <span class="s">&#39;dti&#39;</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Cannot pvutils.boxcar along DateTime axis.&#39;</span><span class="p">)</span>

      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transfer</span><span class="p">(</span><span class="n">pvutils</span><span class="o">.</span><span class="n">boxcar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binwidth</span><span class="o">=</span><span class="n">binwidth</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Spectra.area"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.area">[docs]</a>   <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apply_fcn</span><span class="o">=</span><span class="s">&#39;simps&#39;</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Returns total area under the spectra vs. time curve.  To choose a slice of the spectrum,</span>
<span class="sd">          call wavelength_slices with appropriate ranges and an apply_fcn appropriate to style of integration.</span>

<span class="sd">      Parameters</span>
<span class="sd">      ----------</span>
<span class="sd">         </span>
<span class="sd">      apply_fcn: Integration method-&#39;simps&#39;, &#39;trapz&#39;, &#39;romb&#39;, &#39;cumtrapz&#39;</span>
<span class="sd">         </span>

<span class="sd">      Notes</span>
<span class="sd">      -----</span>
<span class="sd">         This is a wrapper for wavelength_sclices, and as such, user can actually pass any function into the apply_fcn. </span>
<span class="sd">         Besides mean/sum which is understands already, one could, for example, pass a euler integration function and</span>
<span class="sd">         it should work. </span>

<span class="sd">         WHEN PLOTTING, PLOT THE TRANSPOSE OF THE RETURNED DF.</span>
<span class="sd">      &quot;&quot;&quot;</span>

      <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_slices</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="c">#min(self.index),</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="c">#max(self.index)), </span>
                                    <span class="n">apply_fcn</span><span class="o">=</span><span class="n">apply_fcn</span><span class="p">)</span>

      <span class="n">out</span><span class="o">.</span><span class="n">specifier</span> <span class="o">=</span> <span class="s">&#39;Area (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">apply_fcn</span>
      <span class="k">return</span> <span class="n">out</span>


   <span class="c"># Spectral column attributes/properties</span>
   <span class="c">### SPECUNIT IS JUST CARRIED THROUGH ON DF._INDEX.  ANYCHANGES WILL</span>
   <span class="c">### RETURN A NEW INDEX, AND ALSO UPDATE SPECUNIT IN SAID INDEX!</span></div>
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">specunit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_unit</span><span class="o">.</span><span class="n">short</span>    <span class="c">#Short name key</span>

   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">full_specunit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">_unit</span><span class="o">.</span><span class="n">full</span>

   <span class="nd">@specunit.setter</span>
   <span class="k">def</span> <span class="nf">specunit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
      <span class="c"># Calling self.index will type-check      </span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">CustomIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
      
      <span class="k">else</span><span class="p">:</span>
         <span class="n">_valid_indextype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c">#Raises error in corner cases (leave)               </span>
         <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> 
         
         
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">varunit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">_unit</span><span class="o">.</span><span class="n">short</span>    <span class="c">#Short name key</span>

   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">full_varunit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">_unit</span><span class="o">.</span><span class="n">full</span>

   <span class="nd">@varunit.setter</span>
   <span class="k">def</span> <span class="nf">varunit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
      <span class="c"># Calling self.columns will type-check</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">Unit</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">CustomIndex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span> <span class="c">#self.columns.setter will validate</span>
      
      <span class="c"># If string</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">_valid_indextype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="c">#Raises error in corner cases (leave)      </span>
         <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> 
               
      

<div class="viewcode-block" id="Spectra.as_specunit"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.as_specunit">[docs]</a>   <span class="k">def</span> <span class="nf">as_specunit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Returns new dataframe with different spectral unit on the index.&quot;&quot;&quot;</span>
      <span class="n">tsout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
      <span class="n">tsout</span><span class="o">.</span><span class="n">specunit</span> <span class="o">=</span> <span class="n">unit</span>
      <span class="k">return</span> <span class="n">tsout</span>       
</div>
<div class="viewcode-block" id="Spectra.as_varunit"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.as_varunit">[docs]</a>   <span class="k">def</span> <span class="nf">as_varunit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Returns new dataframe with different spectral unit on the index.&quot;&quot;&quot;</span>
      <span class="n">tsout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
      <span class="n">tsout</span><span class="o">.</span><span class="n">varunit</span> <span class="o">=</span> <span class="n">unit</span>
      <span class="k">return</span> <span class="n">tsout</span>   

   <span class="c"># Still want this?</span></div>
<div class="viewcode-block" id="Spectra.set_specindex"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.set_specindex">[docs]</a>   <span class="k">def</span> <span class="nf">set_specindex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Helper method to generate a spectral index.  Works similarly to</span>
<span class="sd">      pandas.daterange().  Takes in start, stop and spacing.  Users can use</span>
<span class="sd">      either start and stop, start and spacing or stop and spacing (but not </span>
<span class="sd">      start, stop and spacing) to generate specindex.</span>

<span class="sd">      Parameters</span>
<span class="sd">      ----------</span>
<span class="sd">      start: Wavelength start value.</span>
<span class="sd">      stop: Wavelength stop value.</span>
<span class="sd">      spacing: Wavelength spacing.</span>
<span class="sd">      unit: Valid specunit type.  Note, if None is passed, current specunit of</span>
<span class="sd">            object is used.  To force a null unit, use special keyword &#39;null&#39;.</span>

<span class="sd">      Notes</span>
<span class="sd">      -----</span>
<span class="sd">      User must pass 2 of the 3 keywords start, stop or spacing.  Function</span>
<span class="sd">      will compute the other using the length of the current dfindex.  </span>
<span class="sd">      For example, if df.index is 100 entries and user enters start=0, stop=1000,</span>
<span class="sd">      then spacing is set to ten to retain 100 entries.  </span>
<span class="sd">      If user enters start and spacing, then stop is determined to retain 100</span>
<span class="sd">      entries.</span>
<span class="sd">      User can also enter stop and spacing, and start is inferred by counting</span>
<span class="sd">      backwards from stop at steps equal to spacing size.</span>

<span class="sd">      To generate less restricted SpecIndex from start, stop AND spacing, try</span>
<span class="sd">      set_sindex() function in specindex.py module.</span>

<span class="sd">      Under the hood this calls set_sindex() which is a wrapper to</span>
<span class="sd">      np.linspace(). </span>
<span class="sd">      &quot;&quot;&quot;</span>        

      <span class="n">numpts</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

      <span class="c"># If no unit passed, conserve current one</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">unit</span><span class="p">:</span>
         <span class="n">unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">specunit</span>

      <span class="c"># If user wants to force a null unit</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s">&#39;null&#39;</span><span class="p">:</span>
            <span class="n">unit</span><span class="o">=</span><span class="bp">None</span>

      <span class="c"># Bad keyword cases</span>
      <span class="k">if</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">stop</span> <span class="ow">and</span> <span class="n">spacing</span><span class="p">:</span>
         <span class="k">raise</span> <span class="n">badcount_error</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">argnames</span><span class="o">=</span><span class="s">&#39;start, stop, keywords&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">spacing</span><span class="p">:</span>
         <span class="k">raise</span> <span class="n">badcount_error</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">argnames</span><span class="o">=</span><span class="s">&#39;start, stop, keywords&#39;</span><span class="p">)</span>

      <span class="c"># User enters start and stop    </span>
      <span class="k">if</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">stop</span><span class="p">:</span>
         <span class="n">start</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>            
         <span class="n">stop</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>

      <span class="c"># User enters spacing and start or spacing and stop.</span>
      <span class="k">if</span> <span class="n">spacing</span><span class="p">:</span>    
         <span class="n">spacing</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">spacing</span><span class="p">)</span>            
         <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">start</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>                
            <span class="n">stop</span><span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="p">(</span><span class="n">spacing</span> <span class="o">*</span> <span class="n">numpts</span><span class="p">)</span>           
         <span class="k">elif</span> <span class="n">stop</span><span class="p">:</span>
            <span class="n">stop</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="n">start</span><span class="o">=</span><span class="n">stop</span> <span class="o">-</span> <span class="p">(</span><span class="n">spacing</span> <span class="o">*</span> <span class="n">numpts</span><span class="p">)</span>

      <span class="c"># If user only entered one keyword, then all three will not be generated by this point </span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">start</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
         <span class="k">raise</span> <span class="n">badcount_error</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">argnames</span><span class="o">=</span><span class="s">&#39;start, stop, keywords&#39;</span><span class="p">)</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">numpts</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>


   <span class="c">###################################</span>
   <span class="c"># Baseline related operations ###</span>
   <span class="c">###################################</span>

   <span class="c"># SHOULD ALSO ENFORCE DATATYPES</span></div>
   <span class="k">def</span> <span class="nf">_base_gate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Quick check to see if self._baseline is found or missing.  If missing,</span>
<span class="sd">          raises error.  If found, passes.&quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">):</span>
         <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Baseline not found.&#39;</span><span class="p">)</span>        

<div class="viewcode-block" id="Spectra.sub_base"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.sub_base">[docs]</a>   <span class="k">def</span> <span class="nf">sub_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Subtracts baseline from entire dataset.</span>

<span class="sd">          Notes:</span>
<span class="sd">          -----</span>
<span class="sd">            Does have to call self._frame.  Just doing self.sub will not work, even though</span>
<span class="sd">            calling ts.sub() from an outside program does in fact work.  Behavior is due</span>
<span class="sd">            to way in which python classes deal with overwrites of self.&quot;&quot;&quot;</span>

      <span class="c"># self._baseline is not none</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_base_gate</span><span class="p">()</span>

      <span class="c"># Only subtract if baseline isn&#39;t currently subtracted</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span><span class="p">:</span>
         <span class="c"># Index, although should be correct, is type object and is getting falses for entries...</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&#39;Subtracting baseline, but may not have all: elements being equal.  Fix index&#39;</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span> <span class="o">=</span> <span class="bp">True</span>

      <span class="k">else</span><span class="p">:</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Baseline is already subtracted.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Spectra.add_base"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.add_base">[docs]</a>   <span class="k">def</span> <span class="nf">add_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Adds baseline to data that currently has it subtracted.&quot;&quot;&quot;</span>

      <span class="c"># self._baseline is not none</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_base_gate</span><span class="p">()</span>

      <span class="c"># Only add if baseline is currently in a subtracted state</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span> <span class="o">=</span> <span class="bp">False</span>

      <span class="c">#else:</span>
         <span class="c">#print &#39;raise waring? already added&#39;        </span>
</div>
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">base_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Is baseline currently subtracted from spectral data.&quot;&quot;&quot;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_base_gate</span><span class="p">()</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span>


   <span class="k">def</span> <span class="nf">_valid_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseline</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Validates user-supplied baseline before setting.  Mostly,</span>
<span class="sd">          ensures that baseline.index == self._frame.index&quot;&quot;&quot;</span>


      <span class="k">if</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span><span class="p">(</span><span class="s">&#39;Baseline is None&#39;</span><span class="p">)</span>
         <span class="k">return</span> 

      <span class="c"># If baseline not iterable, return series of constant values</span>
      <span class="k">try</span><span class="p">:</span>
         <span class="n">baseline</span><span class="o">.</span><span class="n">__iter__</span>
      <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span><span class="p">(</span><span class="s">&#39;Baseline is not iterable; filling with constant &#39;</span>
                       <span class="s">&#39;value </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">baseline</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>


      <span class="c"># If Series compare index values</span>
      <span class="c"># NEED A SPEC INDEX CLASS, THEN REMOE MOST OF THIS</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">baseline</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BaselineError</span><span class="p">(</span><span class="s">&#39;Baseline shape mismatch </span><span class="si">%s</span><span class="s"> vs </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span>
                                <span class="o">%</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span><span class="p">(</span><span class="s">&#39;Baseline is a series; has identical index &#39;</span> 
                             <span class="s">&#39;to self._frame.index&#39;</span><span class="p">)</span>
               <span class="k">return</span> <span class="n">baseline</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span><span class="p">(</span><span class="s">&#39;Baseline is a series; shape identical to&#39;</span>
                             <span class="s">&#39; self.index.shape; but elements are not equal.&#39;</span><span class="p">)</span>
               <span class="n">mytype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span>
               <span class="n">bline_type</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span>

               <span class="k">try</span><span class="p">:</span>
                  <span class="n">baseline</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">mytype</span>
               <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                  <span class="k">raise</span> <span class="n">BaselineError</span><span class="p">(</span><span class="s">&#39;Baseline index (</span><span class="si">%s</span><span class="s">) could not be cast to  &#39;</span>
                                      <span class="s">&#39;self.index.type (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bline_type</span><span class="p">,</span> <span class="n">mytype</span><span class="p">))</span>
               <span class="k">else</span><span class="p">:</span>
                  <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Baseline index type (</span><span class="si">%s</span><span class="s">) converted to self.index &#39;</span>
                              <span class="s">&#39;type (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bline_type</span><span class="p">,</span> <span class="n">mytype</span><span class="p">))</span>
                  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">baseline</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                     <span class="k">return</span> <span class="n">baseline</span>
                  <span class="k">else</span><span class="p">:</span>
                     <span class="k">raise</span> <span class="n">BaselineError</span><span class="p">(</span><span class="s">&#39;Baseline index != self._frame.index&#39;</span><span class="p">)</span>

   <span class="c"># If other type of iterable, make series</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c"># Make sure length is correct</span>
         <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comment</span><span class="p">(</span><span class="s">&quot;Baseline is iterable, but not a Series; converting&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BaselineError</span><span class="p">(</span><span class="s">&#39;Baseline must be of length </span><span class="si">%s</span><span class="s"> to &#39;</span>
                                <span class="s">&#39;match the current spectral index.&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>


<div class="viewcode-block" id="Spectra.plot"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.plot">[docs]</a>   <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">pltkwargs</span><span class="p">):</span>   
      <span class="sd">&quot;&quot;&quot; Plotting interface.  Use kind=&#39;surf, wire etc...&#39; to go through </span>
<span class="sd">      various plot types.  Will append correct x and y labels.</span>
<span class="sd">      &quot;&quot;&quot;</span>      
      <span class="k">return</span> <span class="n">specplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">pltkwargs</span><span class="p">)</span>
            
</div>
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c"># Should these be stored as specrum?  Cause right now, just converting on return</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">Spectrum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>


   <span class="nd">@baseline.setter</span>
   <span class="k">def</span> <span class="nf">baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bline</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Allows user to set a baseline curve with a variety of options.&quot;&quot;&quot;</span>
      <span class="c">## Logic.  Need validation for various cases.</span>
      <span class="c"># Depending on type/length, force or set index?  What about non-equal length types,</span>
      <span class="c"># try an interpolation?</span>
      <span class="c"># End th &quot;valid_base&quot; </span>

      <span class="n">bline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_baseline</span><span class="p">(</span><span class="n">bline</span><span class="p">)</span>

      <span class="c"># Data does not current contain subtracted baseline</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span> <span class="o">=</span> <span class="n">bline</span>

      <span class="c"># Data does contain subtracted baseline</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">add_base</span><span class="p">()</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span><span class="o">=</span><span class="n">bline</span>
         <span class="c"># If baseline is not none, go ahead and re-subtract</span>
         <span class="k">if</span> <span class="n">bline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sub_base</span><span class="p">()</span>


   <span class="c"># Spectral Intensity related attributes/conversions</span>
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">full_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">_normdic</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_normtype</span><span class="p">]</span>

   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normtype</span>

   <span class="nd">@norm.setter</span>
   <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>     
      <span class="sd">&quot;&quot;&quot; Change norm in place.&quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="s">&#39;full&#39;</span><span class="p">]:</span>
            <span class="n">unit</span><span class="o">=</span><span class="bp">None</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">_set_normtype</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>        


<div class="viewcode-block" id="Spectra.as_norm"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.as_norm">[docs]</a>   <span class="k">def</span> <span class="nf">as_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Returns new Spectra of modified norm.  Useful if in-place operation not desirable.  </span>
<span class="sd">      Also has the option of manually passing a new reference for on-the-fly rereferencing.&quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">unit</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="s">&#39;full&#39;</span><span class="p">]:</span>
            <span class="n">unit</span><span class="o">=</span><span class="bp">None</span>


      <span class="n">tsout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>        
      <span class="n">tsout</span><span class="o">.</span><span class="n">_set_normtype</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">tsout</span>

</div>
   <span class="k">def</span> <span class="nf">_set_normtype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sout</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot;Function used to change spectral intensity representation in a convertible manner. Not called on</span>
<span class="sd">      initilization of Spectra(); rather, only called by as_norm() method.&quot;&quot;&quot;</span>

      <span class="n">sout</span> <span class="o">=</span> <span class="n">_valid_norm</span><span class="p">(</span><span class="n">sout</span><span class="p">)</span>
      <span class="n">sin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normtype</span>
      <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span> <span class="c">#Could also work just by calling self...</span>

      <span class="c"># Corner case, for compatibility with reference.setter</span>
      <span class="k">if</span> <span class="n">sin</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">sout</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
         <span class="k">return</span>

      <span class="c">########################################################################</span>
      <span class="c"># Case 1: User converting from full data down to referenced data.#####</span>
      <span class="c">########################################################################</span>
      <span class="k">if</span> <span class="n">sin</span><span class="o">==</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">sout</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">rout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference_valid</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

         <span class="c"># If user tries to downconvert but doesn&#39;t pass reference, use stored one</span>
         <span class="k">if</span> <span class="n">rout</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">rout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span>

         <span class="c"># If ref not passed, use current reference.  Want to make sure it is </span>
         <span class="c"># not none, but have to roundabout truthtest</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rout</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Cannot convert spectrum to norm </span><span class="si">%s</span><span class="s"> without a reference&#39;</span><span class="o">%</span><span class="n">sout</span><span class="p">)</span>                
         <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">=</span><span class="n">pvutils</span><span class="o">.</span><span class="n">divby</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">divisor</span><span class="o">=</span><span class="n">rout</span><span class="p">)</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">from_T</span><span class="p">[</span><span class="n">sout</span><span class="p">])</span>                    
         <span class="c">#Assumes typeerror is due to rout not being a series/array, but doesn&#39;t further test it.  EG do another</span>
         <span class="c">#typeerror check of try: if rout == None: raise error</span>


      <span class="c">##############################################################   </span>
      <span class="c"># Case 2: Changing spectral representation of converted data.#</span>
      <span class="c">##############################################################     </span>
      <span class="k">elif</span> <span class="n">sin</span> <span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">sout</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>

         <span class="c"># If user changing reference on the fly, need to change ref ###</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">):</span> <span class="c">#and ref != self._reference:</span>
            <span class="n">rout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference_valid</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

            <span class="c"># Make this it&#39;s own method called change reference?</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">to_T</span><span class="p">[</span><span class="n">sin</span><span class="p">])</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
            <span class="n">df</span><span class="o">=</span><span class="n">pvutils</span><span class="o">.</span><span class="n">divby</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">divisor</span><span class="o">=</span><span class="n">rout</span><span class="p">)</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">from_T</span><span class="p">[</span><span class="n">sout</span><span class="p">])</span>                        


         <span class="k">else</span><span class="p">:</span>
            <span class="n">rout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference</span> <span class="c">#For sake of consistent transferring at end of this function</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">to_T</span><span class="p">[</span><span class="n">sin</span><span class="p">])</span>
            <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">from_T</span><span class="p">[</span><span class="n">sout</span><span class="p">])</span>        


      <span class="c">###########################################################    </span>
      <span class="c"># Case 3: User converting referenced data up to full data.#</span>
      <span class="c">#############################################################</span>
      <span class="k">elif</span> <span class="n">sin</span> <span class="o">!=</span><span class="bp">None</span> <span class="ow">and</span> <span class="n">sout</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
         <span class="n">rout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference_valid</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

         <span class="k">if</span> <span class="n">rout</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">rout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reference</span>

         <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">to_T</span><span class="p">[</span><span class="n">sin</span><span class="p">])</span>
         <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">rout</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c">#Multiply up!</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">_reference</span><span class="o">=</span><span class="n">rout</span>       
      <span class="bp">self</span><span class="o">.</span><span class="n">_normtype</span><span class="o">=</span><span class="n">sout</span>        
      <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">=</span><span class="n">df</span>    

   <span class="c">############################################ </span>
   <span class="c">#####Overwrite MetaDataFrame behavior ########</span>
   <span class="c">############################################    </span>


   <span class="k">def</span> <span class="nf">_valid_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Recast index to self._strict_index &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_index</span><span class="p">:</span>       
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_index</span><span class="p">):</span>

            <span class="c"># Cornercase User passes PressureIndex where SpecIndex required</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">ConversionIndex</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">CustomIndex</span><span class="p">):</span>
               <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&#39;Invalid index type: </span><span class="si">%s</span><span class="s">; require </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> 
                               <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_index</span><span class="p">))</span>                
            <span class="k">try</span><span class="p">:</span>
               <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
               <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&#39;Could not convert index to </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> 
                               <span class="bp">self</span><span class="o">.</span><span class="n">_strict_index</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="c"># If subclassing ConversionIndex</span>
               <span class="k">try</span><span class="p">:</span>
                  <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unit</span>
               <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                  <span class="k">pass</span>
               <span class="k">else</span><span class="p">:</span>
                  <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>                        

      <span class="k">return</span> <span class="n">index</span>


   <span class="k">def</span> <span class="nf">_valid_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Recast columns to self._strict_columns &quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_columns</span><span class="p">:</span>        
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_columns</span><span class="p">):</span>

            <span class="c"># User passes a valid skspec index type    </span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">ConversionIndex</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">CustomIndex</span><span class="p">):</span>
               <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&#39;Invalid column type: </span><span class="si">%s</span><span class="s">; require </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> 
                               <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">columns</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_columns</span><span class="p">))</span>


            <span class="c"># Attempts to force type conversion into self._strict_column</span>
            <span class="k">try</span><span class="p">:</span>
               <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
               <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&#39;Could not convert columns to </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> 
                               <span class="bp">self</span><span class="o">.</span><span class="n">_strict_columns</span> <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>                    
               <span class="c"># If subclassing ConversionIndex</span>
               <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
               <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>                                 

      <span class="k">return</span> <span class="n">columns</span>


   <span class="c"># Properies</span>
   <span class="c"># ---------------</span>
 

   <span class="c"># Necessary even though these are already defined in metadataframe</span>
   <span class="c"># Setter looks for them on this object</span>
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span>

   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span>


   <span class="nd">@index.setter</span>
   <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>    


   <span class="nd">@columns.setter</span>
   <span class="k">def</span> <span class="nf">columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>


   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">cnsvdattr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; attr:value of conserved attributes&quot;&quot;&quot;</span>
      <span class="n">csvdout</span><span class="o">=</span><span class="p">{}</span>
      <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdattr</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
            <span class="n">csvdout</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">csvdout</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">return</span> <span class="n">csvdout</span>

   <span class="nd">@cnsvdattr.setter</span>
   <span class="k">def</span> <span class="nf">cnsvdattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Set which attributes are mutated in DataFrame operations via cons_methods.&quot;&quot;&quot;</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
         <span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="n">attrs</span><span class="p">]</span>

      <span class="n">consout</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
         <span class="k">try</span><span class="p">:</span>
            <span class="n">consout</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
         <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> not found on object </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span> 

      <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdattr</span><span class="o">=</span><span class="n">consout</span>

   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">cnsvdmeth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdmeth</span>

   <span class="nd">@cnsvdmeth.setter</span>
   <span class="k">def</span> <span class="nf">cnsvdmeth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
      <span class="c"># Do I even want to do anything more than setter?</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
         <span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="n">attrs</span><span class="p">]</span>

      <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
         <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
            <span class="k">pass</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> has no attribute &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdmeth</span><span class="o">=</span><span class="n">attrs</span>        

   <span class="k">def</span> <span class="nf">_framegetattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="o">*</span><span class="n">fcnargs</span><span class="p">,</span> <span class="o">**</span><span class="n">fcnkwargs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Overloading MEtaPandas Object, returns a new object, either</span>
<span class="sd">      Spectra or Spectrum with attributes properly conserved.  Handles special</span>
<span class="sd">      cases, for example, if returning Spectrum instead of Spectra.  Will</span>
<span class="sd">      conserve attributes such as baseline/reference.</span>

<span class="sd">      Notes:</span>
<span class="sd">      -----</span>
<span class="sd">      Since new series items always have a name by default, an originally unnamed series</span>
<span class="sd">      attribute (such as reference) will end with a name=_reference afterwards.  Added a hack</span>
<span class="sd">      to intercept this highly common attribute and apply to output.&quot;&quot;&quot;</span>

      <span class="n">out</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="p">,</span> <span class="n">attr</span><span class="p">)(</span><span class="o">*</span><span class="n">fcnargs</span><span class="p">,</span> <span class="o">**</span><span class="n">fcnkwargs</span><span class="p">)</span>

      <span class="c"># If operation returns a dataframe, return new Spectra</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">):</span>

         <span class="c"># Are there specially conserved attributes?</span>
         <span class="n">csvdout</span><span class="o">=</span><span class="bp">None</span>
         <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdmeth</span><span class="p">:</span>    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnsvdattr</span><span class="p">:</span>
               <span class="n">cnsvdattr</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnsvdattr</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> 
                              <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>

               <span class="n">csvdf</span><span class="o">=</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cnsvdattr</span><span class="p">)</span>  <span class="c">#STILL WORKS WITH NONEQUAL LENGTH</span>
               <span class="n">_csvdfattrs</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">attr</span><span class="p">,</span> <span class="p">(</span><span class="n">cnsvdattr</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">__dict__</span><span class="p">))</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">cnsvdattr</span><span class="p">)</span>

               <span class="k">try</span><span class="p">:</span>
                  <span class="n">csvdout</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">csvdf</span><span class="p">,</span> <span class="n">attr</span><span class="p">)(</span><span class="o">*</span><span class="n">fcnargs</span><span class="p">,</span> <span class="o">**</span><span class="n">fcnkwargs</span><span class="p">)</span>
               <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                  <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Could not successfully perform operation &quot;</span><span class="si">%s</span><span class="s">&quot; on one or multiple </span><span class="se">\</span>
<span class="s">                        conserved attributes </span><span class="si">%s</span><span class="s">.&#39;</span><span class="o">%</span><span class="n">attr</span><span class="p">,</span> <span class="s">&#39;&quot;,&quot;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csvdout</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>                               

         <span class="c"># Create new timespectra object</span>
         <span class="n">tsout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transfer</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

         <span class="c"># Apply conserved attributes for example, if baseline was sliced</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">csvdout</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">csvdout</span><span class="p">:</span>

               <span class="c"># Restore custom attributes on the cnsvdattributes</span>
               <span class="n">restattr</span><span class="o">=</span><span class="p">[</span><span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">_csvdfattrs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">attr</span> <span class="ow">not</span> <span class="ow">in</span> 
                         <span class="n">csvdout</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">__dict__</span><span class="p">]</span>
               <span class="k">if</span> <span class="n">restattr</span><span class="p">:</span>
                  <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">restattr</span><span class="p">:</span>
                     <span class="nb">setattr</span><span class="p">(</span><span class="n">csvdout</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">attr</span><span class="p">,</span> <span class="n">_csvdfattrs</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">attr</span><span class="p">])</span> 

                  <span class="c"># Hack to conserve &quot;name&quot; attribute of series return</span>
                  <span class="k">try</span><span class="p">:</span>
                     <span class="nb">setattr</span><span class="p">(</span><span class="n">csvdout</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">_csvdfattrs</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span> 
                  <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                     <span class="k">pass</span>

               <span class="c"># Apply conserved attributes to new dataframe                        </span>
               <span class="nb">setattr</span><span class="p">(</span><span class="n">tsout</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">csvdout</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

         <span class="k">return</span> <span class="n">tsout</span>

      <span class="c"># Otherwise return whatever the method return would be</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
         <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">from_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
         
      <span class="k">else</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">out</span>
      
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      
      <span class="n">delim</span> <span class="o">=</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">HEADERDELIM</span>
      
      <span class="n">header</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Spectra</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_header</span>
      
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">base</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="s">&#39;Subtracted&#39;</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="s">&#39;Found (no sub)&#39;</span>
            
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">ref</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">ref</span> <span class="o">=</span> <span class="s">&#39;Found&#39;</span>
         

      <span class="n">header</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Baseline: </span><span class="si">%s%s</span><span class="s">Reference: </span><span class="si">%s%s</span><span class="s">Normalization: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>\
                                                               <span class="p">(</span><span class="n">base</span><span class="p">,</span> 
                                                                <span class="n">delim</span><span class="p">,</span> 
                                                                <span class="n">ref</span><span class="p">,</span>
                                                                <span class="n">delim</span><span class="p">,</span> 
                                                                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">norm</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">header</span>
   
      
   <span class="nd">@property</span>
   <span class="k">def</span> <span class="nf">_header_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Add normalization, baseline, reference. &quot;&quot;&quot;</span>
      <span class="n">delim</span> <span class="o">=</span> <span class="n">pvconfig</span><span class="o">.</span><span class="n">HEADERHTMLDELIM</span>
      
      <span class="c">#http://www.w3schools.com/html/html_colors.asp</span>
      <span class="k">def</span> <span class="nf">_red</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
         <span class="k">return</span> <span class="s">&#39;&lt;font color=&quot;#CC0033&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/font&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> 
      
      <span class="k">def</span> <span class="nf">_green</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
         <span class="k">return</span> <span class="s">&#39;&lt;font color=&quot;#009900&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/font&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> 
         
      
      <span class="n">header</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Spectra</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_header_html</span>
      
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">norm</span> <span class="o">=</span> <span class="n">_red</span><span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">norm</span> <span class="o">=</span> <span class="n">_green</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_norm</span><span class="p">)</span> <span class="c">#Actually use the value</span>
         
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseline</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">base</span> <span class="o">=</span> <span class="n">_red</span><span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_sub</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">_green</span><span class="p">(</span><span class="s">&#39;Subtracted&#39;</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">_green</span><span class="p">(</span><span class="s">&#39;Found&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; (no sub)&#39;</span>
         
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reference</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">ref</span> <span class="o">=</span> <span class="n">_red</span><span class="p">(</span><span class="s">&#39;None&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">ref</span> <span class="o">=</span> <span class="n">_green</span><span class="p">(</span><span class="s">&#39;Found&#39;</span><span class="p">)</span>
         

      <span class="n">header</span> <span class="o">+=</span> <span class="s">&#39;&lt;br&gt;&lt;br&gt;Baseline: </span><span class="si">%s%s</span><span class="s">Reference: </span><span class="si">%s%s</span><span class="s">Normalization: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> 
                                                              <span class="n">delim</span><span class="p">,</span> 
                                                              <span class="n">ref</span><span class="p">,</span>
                                                              <span class="n">delim</span><span class="p">,</span> 
                                                              <span class="n">norm</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">header</span>
   

   <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyslice</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39; Item lookup.  If output is an interable, _transfer is called.  </span>
<span class="sd">      Sometimes __getitem__ returns a float (indexing a series) at which </span>
<span class="sd">      point we just want to return that.&#39;&#39;&#39;</span>

      <span class="n">dfout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">keyslice</span><span class="p">)</span>
       
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dfout</span><span class="p">,</span> <span class="n">Series</span><span class="p">):</span>
         <span class="k">return</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">from_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfout</span><span class="p">)</span>
       
      <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Spectra</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">keyslice</span><span class="p">)</span>
    


<div class="viewcode-block" id="Spectra.split_by"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.split_by">[docs]</a>   <span class="k">def</span> <span class="nf">split_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">stackkwargs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Slice data into n subsets.</span>

<span class="sd">      Notes</span>
<span class="sd">      -----</span>
<span class="sd">      If n does not evenly divide the axis, the final element returned tends</span>
<span class="sd">      to be larger than the others (culmination of rounding down iteratively)</span>
<span class="sd">      and a warning is raised.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="n">ts_split</span> <span class="o">=</span> <span class="n">pvutils</span><span class="o">.</span><span class="n">split_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">astype</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
      <span class="n">stackkwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">stack</span><span class="p">:</span>
         <span class="n">ts_split</span> <span class="o">=</span> <span class="n">SpecStack</span><span class="p">(</span><span class="n">ts_split</span><span class="p">,</span> <span class="o">**</span><span class="n">stackkwargs</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">ts_split</span>


   <span class="c"># Output</span>
   <span class="c">#-------</span>
   </div>
<div class="viewcode-block" id="Spectra.to_R_df"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.to_R_df">[docs]</a>   <span class="k">def</span> <span class="nf">to_R_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Wraps pandas.rpy.common import convert_to_r_dataframe.&quot;&quot;&quot;</span>

      <span class="kn">from</span> <span class="nn">pandas.rpy.common</span> <span class="kn">import</span> <span class="n">convert_to_r_dataframe</span>
      <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Converting </span><span class="si">%s</span><span class="s"> to R dataframe.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_name</span><span class="p">)</span>
      <span class="k">return</span><span class="p">(</span> <span class="n">convert_to_r_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="p">)</span> <span class="p">)</span>      
</div>
<div class="viewcode-block" id="Spectra.to_csv"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.to_csv">[docs]</a>   <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_or_buff</span><span class="p">,</span> <span class="n">meta_separate</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">csv_kwargs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Output to CSV file.  </span>

<span class="sd">          Parameters:</span>
<span class="sd">          ----------</span>
<span class="sd">             path_or_buff: string path to outfile destination.</span>

<span class="sd">             meta_separate: </span>
<span class="sd">                 If None: metadata is lost and self._frame.to_csv(**csv_kwargs) is called.</span>
<span class="sd">                 If False: metadata is serialized and output at tail file the path_or_buff file.</span>
<span class="sd">                 If True: metadata is added to it&#39;s own file named path_or_buff.mdf</span>

<span class="sd">             csv_kwargs: csv formatting arguments passed directoy to self._frame.to_csv()</span>

<span class="sd">          Notes:</span>
<span class="sd">          ------</span>
<span class="sd">             MetaData is gotten from self.__dict__.</span>
<span class="sd">             In future, may opt to implement the option to choose the meta_separate filename if </span>
<span class="sd">             output is separated (eg meta_separate=True)</span>

<span class="sd">      &quot;&quot;&quot;</span>

      <span class="n">meta</span><span class="o">=</span><span class="n">cPickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buff</span><span class="p">,</span> <span class="o">**</span><span class="n">csv_kwargs</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">meta_separate</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
         <span class="k">return</span>
      <span class="k">elif</span> <span class="n">meta_separate</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
         <span class="k">raise</span> <span class="bp">NotImplemented</span><span class="p">(</span><span class="s">&#39;Not yet implemented this style of csv output&#39;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">meta_separate</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
         <span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&#39;Adding metadata to csv; feature is UNDER CONSTRUCTION...&#39;</span><span class="p">)</span>
         <span class="n">o</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">path_or_buff</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="c">#&#39;w&#39;?#</span>
         <span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
         <span class="n">o</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


   <span class="c"># CLASS METHODS</span>
   <span class="c"># -------------</span>

</div>
   <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Spectra.from_csv"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.from_csv">[docs]</a>   <span class="k">def</span> <span class="nf">from_csv</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">header_datetime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                <span class="n">index_datetime</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Read from CSV file.  Wrapping pandas read_csv:</span>
<span class="sd">      http://pandas.pydata.org/pandas-docs/version/0.13.1/  \</span>
<span class="sd">      generated/pandas.io.parsers.read_csv.html</span>

<span class="sd">      Parameters:</span>
<span class="sd">      ----------</span>
<span class="sd">      filepath_or_buffer: (from pandas API) string or file handle / StringIO. </span>
<span class="sd">      The string could be a URL. Valid URL schemes include http, ftp, s3, </span>
<span class="sd">      and file. For file URLs, a host is expected. For instance, a local </span>
<span class="sd">      file could be file.</span>

<span class="sd">      header_datetime: bool or format str (False)</span>
<span class="sd">          Used to parse files with header that is a datetime string.  </span>
<span class="sd">          User must pass a format string e.g. %Y/%m/%d %H:%M:%S, which</span>
<span class="sd">          is the default.  Results in DatetimeIndex as label.  This will</span>
<span class="sd">          set the varunit to &#39;dti&#39; automatically, unless specifically</span>
<span class="sd">          set as None.</span>

<span class="sd">      index_datetime: bool or format str (False)</span>
<span class="sd">          Used to parse files with header that is a datetime string.  </span>
<span class="sd">          User must pass a format string e.g. %Y/%m/%d %H:%M:%S, which</span>
<span class="sd">          is the default.   Results in DatetimeIndex as label.  This will</span>
<span class="sd">          set the specunit to &#39;dti&#39; automatically, unles specifically set</span>
<span class="sd">          as None.</span>

<span class="sd">      **kwargs: Any valid spectra or pandas readcsv() kwargs.       </span>

<span class="sd">      Returns: Spectra</span>
<span class="sd">      &quot;&quot;&quot;</span>


      <span class="n">_CSVKWDS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span> 
                      <span class="n">dialect</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">compression</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">doublequote</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                      <span class="n">escapechar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">quotechar</span><span class="o">=</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> 
                      <span class="n">quoting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                      <span class="n">skipinitialspace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                      <span class="n">lineterminator</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">header</span><span class="o">=</span><span class="s">&#39;infer&#39;</span><span class="p">,</span> 
                      <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">skiprows</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">skipfooter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">skip_footer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                      <span class="n">na_values</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">na_fvalues</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">true_values</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">false_values</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">converters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">dtype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">usecols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">engine</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">delim_whitespace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">as_recarray</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">na_filter</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                      <span class="n">compact_ints</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                      <span class="n">use_unsigned</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                      <span class="n">low_memory</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">buffer_lines</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">warn_bad_lines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                      <span class="n">error_bad_lines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">keep_default_na</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">thousands</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">decimal</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">,</span>
                      <span class="n">parse_dates</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                      <span class="n">keep_date_col</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">dayfirst</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                      <span class="n">date_parser</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">memory_map</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                      <span class="n">nrows</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">iterator</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">chunksize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
                      <span class="n">squeeze</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> 
                      <span class="n">mangle_dupe_cols</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                      <span class="n">tupleize_cols</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">infer_datetime_format</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

      <span class="c"># Pop out any parser keyword args</span>
      <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
         <span class="k">if</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">_CSVKWDS</span><span class="p">:</span>
            <span class="n">_CSVKWDS</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">kw</span><span class="p">]</span>

      <span class="n">df</span> <span class="o">=</span> <span class="n">read_csv</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">_CSVKWDS</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">header_datetime</span><span class="p">:</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_datetime</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">header_datetime</span> <span class="o">=</span> <span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span>      

         <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">header_datetime</span><span class="p">)</span> 
                                     <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>

         <span class="k">if</span> <span class="s">&#39;varunit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;varunit&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;varunit&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;dti&#39;</span><span class="p">:</span>
               <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&quot;from_csv() option &#39;header_dateime&#39; requires&quot;</span>
                               <span class="s">&quot;varunit = &#39;dti&#39; or &#39;None&#39;, received </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;varunit&#39;</span><span class="p">])</span>

         <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;varunit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;dti&#39;</span>   

      <span class="k">if</span> <span class="n">index_datetime</span><span class="p">:</span>
         <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_datetime</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">index_datetime</span> <span class="o">=</span> <span class="s">&#39;%Y/%m/</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span>      

         <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">DatetimeIndex</span><span class="p">([</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">index_datetime</span><span class="p">)</span> 
                                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>

         <span class="k">if</span> <span class="s">&#39;specunit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;specunit&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;specunit&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;dti&#39;</span><span class="p">:</span>
               <span class="k">raise</span> <span class="n">SpecError</span><span class="p">(</span><span class="s">&quot;from_csv() option &#39;index_dateime&#39; requires&quot;</span>
                               <span class="s">&quot;specunit = &#39;dti&#39; or &#39;None&#39;, received </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;specunit&#39;</span><span class="p">])</span>

         <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;specunit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;dti&#39;</span> 
      <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> 

</div>
   <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Spectra.from_series"><a class="viewcode-back" href="../../../API/skspec.core.html#skspec.core.spectra.Spectra.from_series">[docs]</a>   <span class="k">def</span> <span class="nf">from_series</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pandas_object</span><span class="p">,</span> <span class="o">**</span><span class="n">dfkwargs</span><span class="p">):</span>
      <span class="sd">&quot;&quot;&quot; Return a Spectra from a similiar object, either a pandas DataFrame</span>
<span class="sd">      or a skspec Spectra subclass.  Useful for type-casting, for example</span>
<span class="sd">      have a DataFrame and want it as a TimeSpectra, which will do its</span>
<span class="sd">      own index conversions.</span>
<span class="sd">      &quot;&quot;&quot;</span>
      <span class="k">return</span> <span class="n">cls</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pandas_object</span><span class="o">.</span><span class="n">df</span><span class="p">),</span> 
                 <span class="n">index</span><span class="o">=</span><span class="n">pandas_object</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                 <span class="n">columns</span><span class="o">=</span><span class="n">pandas_object</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">dfkwargs</span><span class="p">)</span>

    

<span class="c">## TESTING ###</span></div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>  

   <span class="kn">from</span> <span class="nn">skspec.data</span> <span class="kn">import</span> <span class="n">solvent_evap</span><span class="p">,</span> <span class="n">aunps_glass</span><span class="p">,</span> <span class="n">trip_peaks</span>
   <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
   <span class="n">ts</span> <span class="o">=</span> <span class="n">aunps_glass</span><span class="p">()</span>
   <span class="n">ts</span><span class="o">.</span><span class="n">baseline</span><span class="o">=</span><span class="mi">5</span>
   <span class="k">print</span> <span class="s">&#39;hi&#39;</span>
   <span class="k">print</span> <span class="n">ts</span><span class="o">.</span><span class="n">baseline</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
   <span class="k">print</span> <span class="n">x</span>
   <span class="k">print</span> <span class="n">ts</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>

 
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../API/skspec.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">Installation</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../../../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
            <p class="searchtip" style="font-size: 90%">
                Enter search terms or a module, class or function name.
            </p>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="../../../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../../../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Adam Hughes, ReevesLab Dept. Physics, George Washington University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>