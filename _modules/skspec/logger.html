<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>skspec.logger &mdash; scikit-spectra 0.3.1-2 documentation</title>
    
    <link rel="stylesheet" href="../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3.1-2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="scikit-spectra 0.3.1-2 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../../index.html">scikit-spectra 0.3.1-2 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>


<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/new_logo.png" border="100" alt="sampledoc"/></a>
</div>


    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for skspec.logger</h1><div class="highlight"><pre>
<span class="c">#</span>
<span class="c"># Canopy product code</span>
<span class="c">#</span>
<span class="c"># (C) Copyright 2013 Enthought, Inc., Austin, TX</span>
<span class="c"># All right reserved.</span>
<span class="c">#</span>
<span class="c"># This file is confidential and NOT open source.  Do not distribute.</span>
<span class="c">#</span>

<span class="sd">&#39;&#39;&#39; Client logging tools.  configure_logger() returns a root_logger with separate</span>
<span class="sd">    file and stream handlers.  log() is a flexible decorator that logs a function,</span>
<span class="sd">    displays its arguments and their values, and formatts errors different based</span>
<span class="sd">    on the value of logging.trace; logging.testmode.</span>
<span class="sd">    </span>
<span class="sd">    In the future, this should be consolidated into a Class&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">inspect</span>       
<span class="kn">import</span> <span class="nn">logging</span>        
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">print_exception</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">skspec.exceptions</span> <span class="kn">import</span> <span class="n">LogExit</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span> 

<span class="c"># STRING FORMATTING</span>
<span class="k">def</span> <span class="nf">_fmt_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">max_chars</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span> <span class="n">crop_front</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;str-convert a word.  If it exceeds max_chars, crop it to max_chars - 3</span>
<span class="sd">       and prefix it with &quot;...&quot;  eg:</span>
<span class="sd">          areallylongword ---&gt;  ....lylongword</span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>        
    <span class="n">word</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_chars</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">crop_front</span><span class="p">:</span>
            <span class="n">word</span><span class="o">=</span><span class="s">&#39;...&#39;</span> <span class="o">+</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">max_chars</span><span class="o">-</span><span class="mi">3</span><span class="p">):]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">[:(</span><span class="n">max_chars</span> <span class="o">-</span><span class="mi">3</span><span class="p">)]</span> <span class="o">+</span> <span class="s">&#39;...&#39;</span>
    <span class="k">return</span> <span class="n">word</span>

<span class="k">def</span> <span class="nf">configure_logger</span><span class="p">(</span><span class="n">screenlog</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">screen_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                <span class="n">file_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">filekws</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Instantiates a logger with streamhandler, filehandler or both.</span>
<span class="sd">        Very similar to logging.basicConfig except it allows for simultaneous</span>
<span class="sd">        to-screen and to-file output.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        screenlog : bool</span>
<span class="sd">            Log handler writes to screen.</span>

<span class="sd">        logfile : str (filename)</span>
<span class="sd">            Filename to which loghandler writes</span>

<span class="sd">        screen_level : str of logging.CATEGORY or int</span>
<span class="sd">             Set logging level for screen handler (error, info, debug etc...)</span>

<span class="sd">        file_level : str of logging.CATEGORY or int</span>
<span class="sd">             Set logging level for file handler (error, info, debug etc...)</span>

<span class="sd">        time : bool</span>
<span class="sd">            Prefix log messages with date and time IE:</span>
<span class="sd">               08-12 10:45:27 DEBUG    path/to/module &quot;message&quot;</span>
<span class="sd">                            vs.</span>
<span class="sd">               DEBUG   path/to/module &quot;message&quot;</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            Apparently one must set the root logger level to info, regardless</span>
<span class="sd">            of the child handler level settings to get everything working.  To</span>
<span class="sd">            limit the handler to just ONE type of error, it then requires the</span>
<span class="sd">            use of Filters.</span>

<span class="sd">            The show_all keyword merely changes the root logger name between</span>
<span class="sd">            __name__ and &#39;&#39; which gives this behavior.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        logger : logging.Logger instance</span>

<span class="sd">       &#39;&#39;&#39;</span>

    <span class="c"># Formatting for message, date, time</span>
    <span class="n">out_fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(levelname)-8s</span><span class="s"> </span><span class="si">%(name)-12s</span><span class="s">:  </span><span class="si">%(message)s</span><span class="s">&#39;</span>

    <span class="c"># Ascii fmt of time, if time is enabled</span>
    <span class="n">asci_fmt</span> <span class="o">=</span> <span class="s">&#39;%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span>

    <span class="c"># Output time with logs?</span>
    <span class="k">if</span> <span class="n">time</span><span class="p">:</span>
        <span class="n">out_fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(asctime)s</span><span class="s"> &#39;</span> <span class="o">+</span> <span class="n">out_fmt</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">screenlog</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">logfile</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Cannot create logger without stream.&#39;</span><span class="p">)</span>
    
    <span class="c"># If users pass string args to screen_level, file_level</span>
    <span class="n">screen_level</span><span class="o">=</span> <span class="n">decode_lvl</span><span class="p">(</span><span class="n">screen_level</span><span class="p">)</span>
    <span class="n">file_level</span> <span class="o">=</span> <span class="n">decode_lvl</span><span class="p">(</span><span class="n">file_level</span><span class="p">)</span>

    <span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">root_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>  <span class="c"># Needs to be set; despite handler levels</span>
    
    <span class="c"># Reset any currnet handlers (useful if multiple files call this)</span>
    <span class="n">root_logger</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c"># Add file handler to logger</span>
    <span class="k">if</span> <span class="n">logfile</span><span class="p">:</span>        

        <span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logfile</span><span class="p">,</span> <span class="o">**</span><span class="n">filekws</span><span class="p">)</span>
        <span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">out_fmt</span><span class="p">,</span> <span class="n">asci_fmt</span><span class="p">))</span>
        <span class="n">file_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">file_level</span><span class="p">)</span>
        <span class="n">root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>

    <span class="c"># Add screen handler to logger</span>
    <span class="k">if</span> <span class="n">screenlog</span><span class="p">:</span>        

        <span class="n">screen_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">screen_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">out_fmt</span><span class="p">,</span> <span class="n">asci_fmt</span><span class="p">))</span>
        <span class="n">screen_handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">screen_level</span><span class="p">)</span>
        <span class="n">root_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">screen_handler</span><span class="p">)</span>

    <span class="c"># Better here than getLogger(&#39;&#39;) so that its root status is retained</span>
    <span class="n">root_logger</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">root_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Initialized root logger&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">root_logger</span>


<span class="c">#XXX This needs tested more, particularly when wrapping fcn w/ kwargs</span>
<span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="n">show_args</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">show_values</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">crop_values</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">log_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;  Decorates a function and logs its call signature.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    level : str/int </span>
<span class="sd">        valid logging level (eg &#39;info&#39;, &#39;error&#39;, 40) at which to log mesage.</span>
<span class="sd">        </span>
<span class="sd">    show_args : bool</span>
<span class="sd">        If true, function arguments names will be displayed.  For example:</span>
<span class="sd">            foo(&#39;arg1&#39;, &#39;arg2&#39;, &#39;arg3&#39;)</span>
<span class="sd">            </span>
<span class="sd">    show_values : bool</span>
<span class="sd">        If true, function argument values will be display.  For example:</span>
<span class="sd">            foo( 30, &lt;FooObject at 320323&gt;, {&#39;bar&#39;:&#39;baz&#39;}</span>
<span class="sd">            </span>
<span class="sd">    If show_args and show_values, call signature is reconstructed fully:</span>
<span class="sd">            foo ( &#39;arg1&#39; = 30, &#39;arg2&#39; = &lt;FooObject at 320323&gt; ...)</span>
<span class="sd">            </span>
<span class="sd">    crop_values : bool</span>
<span class="sd">        If true, values longer than certain character limit ( utils._fmt_word() )</span>
<span class="sd">        will be truncated to end with &quot;...&quot;.  This is useful when function </span>
<span class="sd">        arguments are long lists of values.</span>
<span class="sd">        </span>
<span class="sd">    log_name : str or None</span>
<span class="sd">        This decorator does not attempt to inspect the function it is wrapping,</span>
<span class="sd">        so log_name is used to explicitly pass the name which will go to getLogger().</span>
<span class="sd">      </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        description</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    attr : type</span>
<span class="sd">        description</span>
<span class="sd">      </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># Configure logger if it hasn&#39;t been done already</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
        <span class="n">screen_level</span><span class="o">=</span><span class="s">&#39;warning&#39;</span>
        <span class="k">if</span> <span class="s">&#39;-debug&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="n">screen_level</span><span class="o">=</span><span class="s">&#39;debug&#39;</span>
        <span class="k">elif</span> <span class="s">&#39;-info&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="n">screen_level</span><span class="o">=</span><span class="s">&#39;info&#39;</span>
        <span class="n">configure_logger</span><span class="p">(</span><span class="n">screen_level</span><span class="o">=</span><span class="n">screen_level</span><span class="p">)</span>
         
    
    <span class="c"># Either use module logger or (@ so can tell where decorator called)</span>
    <span class="k">if</span> <span class="n">log_name</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">log_name</span><span class="p">)</span>   
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_wraps</span><span class="p">(</span><span class="n">fcn_name</span><span class="p">,</span> <span class="n">fcn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="n">arg_names</span> <span class="o">=</span> <span class="n">fcn</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_varnames</span>    

        <span class="k">if</span> <span class="n">show_args</span><span class="p">:</span>
            <span class="n">arg_str</span> <span class="o">=</span> <span class="n">arg_names</span>
        
        <span class="k">if</span> <span class="n">show_values</span><span class="p">:</span>
            <span class="n">val_str</span> <span class="o">=</span> <span class="n">args</span> <span class="c">#kwargs?</span>
            <span class="k">if</span> <span class="n">crop_values</span><span class="p">:</span>
                <span class="n">val_str</span> <span class="o">=</span> <span class="p">[</span><span class="n">_fmt_word</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">crop_front</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_str</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="n">show_args</span> <span class="ow">and</span> <span class="n">show_values</span><span class="p">:</span>
                
            <span class="c"># This is failing for functions with *args/**kwargs</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">outstr</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg_names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span><span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val_str</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">)</span> \
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">))])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;LOG WRAPPER FAILED FOR </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fcn_name</span><span class="p">)</span>
                <span class="n">outstr</span> <span class="o">=</span> <span class="n">arg_str</span>  
            <span class="k">else</span><span class="p">:</span>  
                <span class="n">outstr</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span> <span class="o">+</span> <span class="n">outstr</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
        
        <span class="k">elif</span> <span class="n">show_args</span><span class="p">:</span>
            <span class="n">outstr</span> <span class="o">=</span> <span class="n">arg_str</span>
            
        <span class="k">elif</span> <span class="n">show_values</span><span class="p">:</span>
            <span class="n">outstr</span> <span class="o">=</span> <span class="n">val_str</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outstr</span> <span class="o">=</span> <span class="s">&#39;()&#39;</span>
        
        <span class="c"># Log command ( *@* to distinguish from manually logged commands)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">decode_lvl</span><span class="p">(</span><span class="n">level</span><span class="p">),</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fcn_name</span><span class="p">,</span> <span class="n">outstr</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>            
            
            <span class="k">return</span> <span class="n">fcn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>             
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            
            <span class="n">ex_type</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        
            <span class="c"># -t USES sys.argv (until fixed; argparse must use -t)</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="s">&#39;-t&#39;</span>  <span class="ow">or</span> <span class="s">&#39;--trace&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
                <span class="n">trace</span> <span class="o">=</span> <span class="bp">True</span>
            
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="n">trc_msg</span> <span class="o">=</span> <span class="s">&#39;{See trace below}&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trc_msg</span> <span class="o">=</span> <span class="s">&#39;{-t, --trace for full traceback}&#39;</span>            
        
            <span class="n">fmt_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">trace</span> <span class="k">else</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">() failed </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">fcn_name</span><span class="p">,</span> <span class="n">fmt_str</span><span class="p">,</span> <span class="n">trc_msg</span><span class="p">)</span>                
        
            <span class="k">if</span> <span class="n">trace</span><span class="p">:</span>
                <span class="n">print_exception</span><span class="p">(</span><span class="n">ex_type</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>
            
            <span class="k">raise</span> <span class="n">LogExit</span> 
    

    <span class="k">def</span> <span class="nf">deco</span><span class="p">(</span><span class="n">fcn</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Generic logger that writes function name and arugment namesto INFO. </span>
<span class="sd">            It also wraps a class method, if the &quot;method&quot; keyword was passed</span>
<span class="sd">            to log().  Its up to the user to make sure actual methods are passed</span>
<span class="sd">            when setting method=True.&#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">method</span><span class="p">:</span>
            
            <span class="c"># Wrap a method, add &quot;self&quot; to args and call function</span>
            <span class="k">def</span> <span class="nf">wraps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                           
                <span class="n">fcn_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fcn</span><span class="o">.</span><span class="n">__name__</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                <span class="n">args</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_wraps</span><span class="p">(</span><span class="n">fcn_name</span><span class="p">,</span> <span class="n">fcn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">wraps</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">fcn_name</span> <span class="o">=</span> <span class="n">fcn</span><span class="o">.</span><span class="n">__name__</span>
                <span class="k">return</span> <span class="n">_wraps</span><span class="p">(</span><span class="n">fcn_name</span><span class="p">,</span> <span class="n">fcn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
                       
        <span class="k">return</span> <span class="n">wraps</span>
    <span class="k">return</span> <span class="n">deco</span>

        
<span class="c"># These logging facilities ought to be consolidated into a class.        </span>
<span class="k">def</span> <span class="nf">decode_lvl</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Converts logging level code (&#39;info, &#39;debug&#39;) to int for logging.log()&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>       
            <span class="n">level</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">logging</span><span class="p">,</span> <span class="n">level</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">level</span>

<span class="k">def</span> <span class="nf">logclass</span><span class="p">(</span><span class="n">public_lvl</span><span class="o">=</span><span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="n">private_lvl</span><span class="o">=</span><span class="s">&#39;debug&#39;</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">logkwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Adds a log decorator to all class methods.  Private methods (_foo)</span>
<span class="sd">        are logged to debug.  Public methods are logged to info.  Magic methods</span>
<span class="sd">        (__foo__) are skipped; as well as methods in the &quot;skip&quot; list.</span>
<span class="sd">        </span>
<span class="sd">        Note: This is a class method, so instance attributes like &quot;name&quot;</span>
<span class="sd">              aren&#39;t defined.  Individual methods should add more explicit</span>
<span class="sd">              logging for this reason.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">wraps</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="n">logkwargs</span><span class="p">[</span><span class="s">&#39;method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="n">magic</span> <span class="o">=</span> <span class="p">[</span><span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span> <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                 <span class="n">method</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;__&#39;</span><span class="p">)]</span>
                    
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    
            <span class="c"># skip attributes, magic methods</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">magic</span> <span class="ow">or</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">skip</span><span class="p">:</span>
                <span class="k">continue</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="p">(</span><span class="n">private_lvl</span><span class="p">,</span> <span class="o">**</span><span class="n">logkwargs</span><span class="p">)(</span><span class="n">value</span><span class="p">))</span>  
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">log</span><span class="p">(</span><span class="n">public_lvl</span><span class="p">,</span> <span class="o">**</span><span class="n">logkwargs</span><span class="p">)(</span><span class="n">value</span><span class="p">))</span> 
        <span class="k">return</span> <span class="n">cls</span>
    <span class="k">return</span> <span class="n">wraps</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../API/skspec.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">Installation</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
            <p class="searchtip" style="font-size: 90%">
                Enter search terms or a module, class or function name.
            </p>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="../../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Adam Hughes, ReevesLab Dept. Physics, George Washington University.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>